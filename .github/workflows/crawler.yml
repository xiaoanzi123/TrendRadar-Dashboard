name: TrendRadar Crawler                                                                                                                                                                                          
  on:                                                                                                          
    # 定时触发：每小时运行一次                                                                                 
    schedule:                                                                                                  
      - cron: '0 * * * *'  # 每小时的第0分钟执行                                                               
                                                                                                               
    # 允许手动触发                                                                                             
    workflow_dispatch:                                                                                         
                                                                                                               
  jobs:                                                                                                        
    crawl:                                                                                                     
      runs-on: ubuntu-latest                                                                                   
                                                                                                               
      steps:                                                                                                   
        - name: Checkout code                                                                                  
          uses: actions/checkout@v4                                                                            
                                                                                                               
        - name: Set up Python                                                                                  
          uses: actions/setup-python@v5                                                                        
          with:                                                                                                
            python-version: '3.11'                                                                             
            cache: 'pip'                                                                                       
                                                                                                               
        - name: Install dependencies                                                                           
          run: |                                                                                               
            cd crawler                                                                                         
            pip install -r requirements.txt                                                                    
                                                                                                               
        - name: Run crawler                                                                                    
          env:                                                                                                 
            DATABASE_URL: ${{ secrets.DATABASE_URL }}                                                          
          run: |                                                                                               
            cd crawler                                                                                         
            python crawler.py                                                                                  
                                                                                                               
        - name: Notify on failure                                                                              
          if: failure()                                                                                        
          run: |                                                                                               
            echo "❌ 爬虫运行失败！请检查日志"                                  
